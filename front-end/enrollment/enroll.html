<!--
Purpose:
This is the page where students enroll in courses.

Content / What it should contain:
List or dropdown of available courses (from courses.txt)
Enroll button for each course
Optionally show if the student is already enrolled
Calls the backend enrollment functions to update enrollments.txt
Styling (internal/external CSS) for buttons and layout
Optional JS for validation or handling button clicks

Example Sections:
Header: “Enroll in Courses”
Table or cards showing course name, teacher, description
Enroll button per course
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enroll in Courses - Mini LMS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            color: #333;
            font-size: 2rem;
        }

        .nav-links {
            display: flex;
            gap: 15px;
        }

        .nav-links a {
            color: #667eea;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: #f0f0f0;
        }

        .courses-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .course-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .course-item:last-child {
            border-bottom: none;
        }

        .course-item:hover {
            background: #f8f9fa;
        }

        .course-info {
            flex: 1;
        }

        .course-info h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        .course-info .teacher {
            color: #666;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .course-info .description {
            color: #555;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .enroll-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.3s;
            white-space: nowrap;
        }

        .enroll-btn:hover {
            opacity: 0.9;
        }

        .enroll-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .enrolled-badge {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Enroll in Courses</h1>
            <div class="nav-links">
                <a href="dashboard.html">My Dashboard</a>
                <a href="../courses/student_courses.html">Browse Courses</a>
                <a href="../../index.html">Home</a>
            </div>
        </header>

        <div id="message"></div>

        <div class="courses-list">
            <div id="coursesContainer">
                <div class="loading">Loading courses...</div>
            </div>
        </div>
    </div>

    <script src="../../back-end/courses/courses.js"></script>
    <script src="../../back-end/enrollment/enrollment.js"></script>
    <script src="../../back-end/auth/auth.js"></script>
    <script>
        const authManager = new AuthManager();
        const courseManager = new CourseManager();
        const enrollmentManager = new EnrollmentManager();
        const currentUser = authManager.getCurrentUser();

        // Check authentication
        if (!currentUser) {
            window.location.href = '../auth/login.html';
        } else if (currentUser.role !== 'student') {
            window.location.href = '../courses/teacher_courses.html';
        }

        let allCourses = [];
        let enrolledCourseIds = [];

        // Load courses and enrollments
        async function loadData() {
            try {
                allCourses = await courseManager.getAllCourses();
                const enrollments = await enrollmentManager.getEnrollmentsByStudent(currentUser.id);
                enrolledCourseIds = enrollments.map(e => e.courseId);
                displayCourses(allCourses);
            } catch (error) {
                showMessage('Error loading courses: ' + error.message, 'error');
            }
        }

        // Display courses
        function displayCourses(courses) {
            const container = document.getElementById('coursesContainer');
            
            if (courses.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No courses available</h3></div>';
                return;
            }

            container.innerHTML = courses.map(course => {
                const isEnrolled = enrolledCourseIds.includes(course.id);
                return `
                    <div class="course-item">
                        <div class="course-info">
                            <h3>${course.name}</h3>
                            <div class="teacher">Teacher: ${course.teacherName}</div>
                            <div class="description">${course.description || 'No description available'}</div>
                        </div>
                        <div>
                            ${isEnrolled ? 
                                '<span class="enrolled-badge">✓ Enrolled</span>' : 
                                `<button class="enroll-btn" onclick="enrollInCourse('${course.id}')">Enroll</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Enroll in course
        async function enrollInCourse(courseId) {
            try {
                const result = await enrollmentManager.enrollStudent(
                    currentUser.id,
                    courseId,
                    currentUser.username
                );

                if (result.success) {
                    showMessage(result.message, 'success');
                    enrolledCourseIds.push(courseId);
                    loadData(); // Reload to update UI
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                showMessage('Error enrolling: ' + error.message, 'error');
            }
        }

        // Show message
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            setTimeout(() => {
                messageDiv.textContent = '';
                messageDiv.className = '';
            }, 3000);
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
